var orm = require(__dirname + "/../lib/orm");

orm.connect("mysql://orm:orm@localhost/orm", function (success, db) {
	if (!success) {
		return console.log("Could not connect to database");
	}

	var Collection = db.define("alltypes", {
		"string"	: String,
		"number"	: Number,
		"boolean"	: Boolean,
		"object"	: Object
	});
	Collection.sync();

	createRecord("true", {
		"string": "true",
		"number": 1,
		"boolean": true,
		"object": { "record": true }
	}, function (rec1) {
		console.log(rec1);
	});

	createRecord("false", {
		"string": "false",
		"number": 0,
		"boolean": false,
		"object": { "record": false }
	}, function (rec2) {
		console.log(rec2);
	});

	function createRecord(str, data, cb) {
		Collection.find({ "string": str }, function (rec) {
			if (rec === null) {
				(new Collection(data)).save(function (err, rec) {
					if (err) {
						return console.log("COULD NOT CREATE RECORD '%s'", str);
					}

					return cb(rec);
				});
			}
		});
	}
});
